## 22/07/24, Sun

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-24_09.45.41.png" width="240px">

[ESP32のGPIOのプルアップ抵抗とプルダウン抵抗が同時にONできちゃうという問題](https://twitter.com/lovyan03/status/1550415522097156096?s=20&t=LCx1C5SQJJOpO_XOEtslmw)があるみたいなんだけど、データシートをみてるんだけど、たしかに両者が独立のビットでON/OFFできるようになっている。これは仕様か設計ミス（回路を簡略化しすぎ）なんかな。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-24_09.46.50.png" width="240px">

なお両抵抗は標準で45kΩ。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-24_10.00.19.png" width="240px">

他のマイコン、例えばLPC821だと、回路上は両抵抗を同時にONできそうになっている。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-24_09.59.07.png" width="240px">

しかし設定レジスタでは、同時にはONにできないようになってる。普通はそうだよな。

そういえば、昨日のUAV Congressの話、中国って、以前はなんでも無法地帯のやりたい放題、みたいなイメージを持ってたけど（そういう面もあるけど）、抑えるべきところはちゃんと法整備して健全に発展できるようにして、場合によってはそれを世界に提案していく、という姿勢だよな。

午後は、昨日参加できなかった[ｽﾀｯｸﾁｬﾝ生誕祭](https://www.youtube.com/watch?v=05N6_kxEsaI)を視聴。ｽﾀｯｸﾁｬﾝはM5Stackを顔部分に使ったオープンソースなコミュニケーションロボットで、なんか不思議な盛り上がり方をしているのは知っていたものの、自分で作ったことはなかった。[GitHubの情報](https://github.com/meganetaaan/stack-chan)などをみながら、これは実際に自分の手元に追いてみたら価値観が変わるやつのような気がして、まずは作ってみることにした。せっかくなので制御基板のPCB/PCBAと筐体の3DプリントをJLCPCBを使ってみることにした。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-24_12.43.07.png" width="240px">

まずは基板のほうの設計データはGitHubからそのままもらってきて、BOMとCPLを作成。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-24_13.06.02.png" width="240px">

LCSCで部品を探してたんだけど、JLCPCBのPCBAだと使えないのがあるみたいなので、調整しながらとりあえず。BOMとCPLは動作チェックが済んだら公開することにしよう。なおサーボ用コネクタなどの挿入実装の部品はJLCPCBのPCBAでは使えないので、完成後に自分ではんだ付けする。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-24_13.23.38.png" width="240px">

筐体の方は、使うサーボに応じてSG90用とFutabaシリアルサーボ用の2種類があるんだけど、せっかくなので1個ずつ、ぜんぶで1700円くらい。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-24_13.26.31.png" width="240px">

ただPCB/PCBAといっしょには発送できないんだそうだ。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-24_14.15.37.png" width="240px">

とTwitterに書いていたら、生みの親の[ししかわさんから、FeeTechのシリアルサーボ用の筐体をつくったところ](https://twitter.com/meganetaaan/status/1551085451670212610)という情報をいただいたので、早速発注。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-24_14.14.10.png" width="240px">

サーボもTaoBaoで発注。これで全部の部品が中国で揃うし、ほとんどWeb上でのやりとりだけで完成できることになる。


## 22/07/25, Mon

[中国のファウンドリSMICに関する記事](https://gigazine.net/news/20220722-china-smic-chip/)をみつけた。7nmの量産を軌道にのせて、世界第3位相当のファウンドリ（TSMC、Samsungの次）になった、という話。記事として若干もられている感もあるけど、そんなに大きく離れてはなさそう。フラッシュメモリみたいに完全規則的なパターンでもないし。

ポイントは、米国からの最先端ノードの製造装置・技術が止められている状況で、自国技術だけでこれができるようになった、ということだな。技術をとめても、多少遅れは出るにしても、開発は進む。そしてそれは不可逆な変化になる。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-25_13.14.27.jpg" width="240px">

[先日訪問したLEDの会社HQG](https://github.com/akita11/SZdiary/blob/main/diary/research/2207-2.md#220714-thu)でサンプルとしていただいたの動作テストをしてた。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-25_13.44.21.jpg" width="240px">

おそらくNeoPixelことWS2812互換だろう、と思って、WS2812と同じように結線してM5StackにつないでUIFlowでテストプログラムを書いたんだけど、どうも挙動が違う。点灯はするんだけど、色がぜんぶ白。プロトコルが違うんかな、と、訪問したときに対応していただいた张さんに問い合わせてデータシートをもらった。制御ICの部分は外から買ったものでそこの詳細はデータシートに書いてある以上のことはわからない、とのことだった。LED部分の専業メーカなんだな。とりあえずデータシートをよむ。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-25_17.50.42.jpg" width="240px">

先日本屋で買うのを諦めてTaoBaoで買ったSiP技術の本が届いた、だいぶ分厚くて重い（600ページ）。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-25_17.51.22.jpg" width="240px">

内容は、SiPの歴史と概要から、設計事例まで幅広いようだ。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-25_17.56.05.jpg" width="240px">

SiPからSiiiPへ。SiiiPはこの本の著者の造語のようで、integrataion（統合）、interconnection（相互配線）、intelligence（知能）という、現代のSiPを表す言葉、ということのようだ。たしかにSiPは、古くはハイブリッドICと呼ばれた基板上に部品が載ったモジュールの進化系だし、そういう意味ではプリント基板との境界はけっこう曖昧。プリント基板のデータ形式であるガーバー形式で取り込んだりする方法も紹介されているようだ。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-25_17.50.49.jpg" width="240px">

MentorにSiP設計ツールがあるそうで、それの実践事例がけっこう詳しく載っている。


## 22/07/26, Tue

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-26_9.36.00.png" width="240px">

先日訪問したLEDメーカのHQGでいただいてきたサンプルのNeoPixelっぽいシリアル制御LED、制御プロトコルがNeoPixelことWorldSemiのWS2812と違うんだな。"1"を表すLの時間が短く、"0"と"1"でH/Lをあわせた時間が同じになってる。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-26_9.36.12.png" width="240px">

こっちがWS2812のパルス幅の仕様。"0"のほうが"1"よりH/Lをあわせた時間が短い。WS2812がシリアル制御LEDのデファクトスタンダードかと思ったんだけど、そうでもないんだな。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-26_11.28.24.png" width="240px">

TaoBaoでM5StackBasicを買おうと探してて、ん？と思うものがあったんだけど、[Shigezoneで売ってるアレ](https://www.shigezone.com/product/cube1/)だった。ニセモノ作られたら一人前。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-26_11.05.25.png" width="240px">

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-26_11.06.07.png" width="240px">

午前は、[以前研究の情報交換をしていたSMEの周(Zhou1)先生](https://github.com/akita11/SZdiary/blob/main/diary/research/2206-1.md#220609-thu)と、いっしょにMEMS力覚センサの研究をしている立命館大の野間先生でオンラインのミーティング、というか野間先生のところのMEMS力覚センサの紹介。周先生が最近一緒に研究を始めたという、MEMSが専門で力覚センサもつくっているLi先生は都合があわずに欠席で、ミーティングの録画をみてもらってWeChatグループで適宜意見交換を続ける、ということになった。お互い、強みと弱みはあるので、うまく補い合っていければいいな、と思う。特にSME側は製造施設を持っていて、小規模とはいえCMOSを含めたMEMSが自前で作れるのは大きい。なおミーティングのツールは、郷に入りては郷に従え、ということで、[Voov(Tensent Meeting)](https://voovmeeting.com/)で。

闇の分解職人ことThousanDIYさんから、[JieLiの開発環境の公式ドキュメント](https://doc.zh-jieli.com/AC63/zh-cn/master/DST/%E7%AC%AC%201%20%E7%AB%A0%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html)を見つけた、という情報をいただいた。情報元は、[GitHubでJieLiのチップをひたすら調べている人のIssueから](https://github.com/christian-kramer/JieLi-AC690X-Familiarization/issues/6)からとのこと。沼の予感しかしない。

そういえばこのまえのｽﾀｯｸﾁｬﾝ、[M5GoBottom版](https://twitter.com/mongonta555/status/1532995173625790465)というのもあって、本体のPortAにサーボをつなぐだけで作れる、つまりドライバの基板をつくらなくていい。いま注文してるのが届いて一通りつくってから、試してみよう。


## 22/07/27, Wed

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-27_15.45.32.png" width="240px">

いろんな意味で話題の「いちばんやささしいWeb3の教本」、資料的な価値として手元に保存しておこうと、回収がはじまったばかりのころに中古本をポチってみた。ぎりぎり間にあったようだ。発送は日本の自宅あてだけど。

JLCPCBやTaoBaoに出してたｽﾀｯｸﾁｬﾝの部品が揃いつつあるので、ファームウエア側をみてるんだけど、標準はLinuxで、Windowsだと面倒（WSL2でいけるかも？）なんですかね。Mac(M1)では[こちらの情報](https://twitter.com/hiroloquy/status/1473256398004056064)を見つけたので、ちょっと試してみよう。[フル機能ではないもののArduinoIDE版のファームウエア](https://raspberrypi.mongonta.com/softwares-for-stackchan/)もあるようだ。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-27_17.05.02.jpg" width="240px">

JLCPCBに出してたｽﾀｯｸﾁｬﾝの筐体とサーボが届いたので、仮組み。FeeTechのMG90とSCS0009はどちらもぴったり。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-27_16.51.49.jpg" width="240px">

shellのパーツは折れないように内側にも梱包材が入っていた。


## 22/07/28, Thu

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-28_16.39.55.png" width="240px">

Elecrowに出している基板で、ちょっと細かい指摘があった。USBコネクタ（平Aプラグ）が基板をはさんで固定する部分が、製品図面では2mmになっていて、そこを2.0mmで設計していたら、「はまらないから1.8mm以下にしろ」という。公差は±0.05mmだから1.9mmなら理解できるんだけど、どういう基準なんだろう。それに同じ担当者なのに以前は指摘されなかった点でもある。基板製造の公差か？

JLCPCBにPCBAをだしていたｽﾀｯｸﾁｬﾝの制御ボードが発送されたようだ。とりあえず[こちら](https://raspberrypi.mongonta.com/softwares-for-stackchan/)の"stack-chan-tester"を、必要なライブラリを入れてビルドはできたようなので、まずはこれで試してみよう。

しかしここ数日ｽﾀｯｸﾁｬﾝの始めようと情報を調べていると、「初見殺し」と紙一重だなあ、と思う。すごく丁寧にGetting Startedが書いてあるんだけど、その上で今回感じた感想。コミュニティを作る上での注意点だな。

- 知らない人にとっては謎な言葉が普通の用語として書いてある（＝知らない自分は、ここに来てはいけないように感じる）
- つまづいたときに「こんなに丁寧に書いてあるのにできないのは、自分だけだろう、だから聞くのも恥ずかしい」と思ってしまう
- 派生形があるんだけど、それをリアルタイムで追っていないと、情報が分散していて見つけにくい（時系列の前後関係がわからない）


## 22/07/29, Fri

[Google/SkywaterのOpenPDK/MPWが、年内に90nmをはじめる](https://opensource.googleblog.com/2022/07/SkyWater-and-Google-expand-open-source-program-to-new-90nm-technology.html?m=1)ようだ。プロセスノード間のPDKの互換性をどうするのか、興味深くウオッチを続けようと思う。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-29_08.58.56.jpg" width="240px">

ｽﾀｯｸﾁｬﾝの仮組み。M5Stackと筐体との固定、公式ではM2ネジだけど、四隅のM3でも大丈夫そう（長い方は18mm前後、Core2の短い方は12mm前後）。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-29_09.00.37.jpg" width="240px">

サーボの固定ネジにあうドライバーが微妙になかったので、あとで华强北で買ってこよう。制御ボードはそろそろ届くはず。ためしに["stack-chan-tester"を書き込んでみた](<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-29_09.37.16.mp4" width="240px">)。急に愛着湧いてくるな。

ｽﾀｯｸﾁｬﾝのFeeTechのシリアルサーボSCS0009版は、ソフトウエアがまだみたいだから、少し着手しようと、まずは情報収取。ID設定とArduinoライブラリは[秋月のページ](https://akizukidenshi.com/catalog/g/gM-16295/)にまとまっている。とりあえず[純正設定ボードURT-1をTaoBaoで](https://item.taobao.com/item.htm?spm=a1z09.2.0.0.1e122e8dBSkkHR&id=603181554943&_u=t207vds3p7f9a2)ポチった。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-29_14.34.34.jpg" width="240px">

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-29_14.48.52.jpg" width="240px">

华强北に精密ドライバー買いに来て、ArduinoやRasPiのロゴのある店をぶらぶら見ながら、建物出ようとしたらすごい夕立で、再びお店をぶらぶら。

今日の午後は、Sony上海の深センオフィスに、高須さんとおじゃましてきた。SPRESENSEやCMOSカメラのユーザコミュニティの作り方とM5Stackの事例、みたいな話などをしていた。やっぱtoioのようなオープンイノベーションの事例や、それが当事者がファンどうしというところから始まったM5Stackとの連携事例、みたいなのは、とても参考になるし社内でももっと広く知られるべきなんじゃないかな、という話とかも。

これにも少し関連するんだけど、事業を費用対効果という点で考えていくと、みんながその方向で努力するので、限りなく利幅がゼロに近づいていってレッドオーシャンになってしまう。そうじゃなくて、ハズレかアタリかわからない（予測できない）チャレンジをする（金融の用語で[「期待価値」](https://yamagatacakes.hatenablog.com/entry/2020/07/08/000000)というんだそうだ）からこそ、大当たり（ホームラン）が出る。そしてこの後者を生むのは、アツい心なわけだ。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-29_22.36.30.jpg" width="240px">

JLCPCBにPCBAだしてたｽﾀｯｸﾁｬﾝの基板がとどいた。裏面に顔のシルクが入ってるの、発注前には気づかなかった・・・ピンヘッダやMbusコネクタを手はんだでつけて完成させる。


## 22/07/30, Sat

昨日参加（オンラインで）できなかった[「シン・ITざっくばらん会 meets event Vol.1 「シン・チホウソウセイ」」](https://www.facebook.com/events/580801013441506)の[録画](https://www.youtube.com/watch?v=Yebr5ghkw6g)を視聴。ゲストは[晝田（ひるた）浩一郎](https://www.facebook.com/koichiro.hiruta.1987)さん。5年前にも金沢に来られていて同様の会が企画されていて参加していた。当時は岡崎市の職員なんだけど、公務員の立場を生かしたいろいろな取組をされていて、とても面白いと思った。特に「公務員はクビにならない、だからいろいろチャレンジできる」という言葉はかなり衝撃的だった。なお晝田さんは、スーパー公務員としてForbesの今年の50人にも選ばれたことがある。

その晝田さんは、いまは「​官民連携研究所」を立ち上げて、行政と民間の関わり方、それを通した地方創生について取り組んでいる。地方創生といえば、よくあるのは、「都会からきた地方創生コンサル」が都会視点のメソッドを持ってきて、地方もそれを盲信しちゃって、ぜんぜんうまくいかない例。晝田さんの取り組みは「企業版ふるさと納税」という形での、行政に対する企業の関わり方を模索し実践している。企業版ふるさと納税は、文字通り「ふるさと納税」の企業版で、企業にとっては税控除のほか、この自治体（地方）との関係性（パートナーシップ）を明確にできる（CSR活動にもなる）、自治体にとっては財源の確保と将来への投資、および企業との関係性を維持できる、というメリットがある。つまり、単発の事業受発注の関係では起こりにくい、「継続的な地方への投資」という側面がある。

この話とは別に、「意識が高い」まちづくりと、「自分がやりたいからやる」まちづくり、という話があった。前者をよく見るんだけど、「ほんとにやりたいんですか？」と言いたくなるのはあるのも事実で、目的と手段がどっちなんだっけ？というのもよくある。後者は「意識が高い意味づけ（教育、地域活性化など）」は可能だが、それはあくまでも後付であるであるべきで、そういうののほうがうまくいく事例は多い、という話。NT金沢やMakeにも通じる話ではある。

滋賀県立大の土谷先生が、[Google/SkywaterのMPW用の全部入りDocker環境](https://note.com/akira_tsuchiya/n/n1b1cc2bdb5b2)をつくられていた。来週の電子情報通信学会のICD研究会ではそれを使ったチュートリアルもやるようで、ぜひ（リモートで）参加しようと思っていたんだけど、都合があわなくなりそうで、断念。この資料を参考に、再度チャレンジしようと思う。

ｽﾀｯｸﾁｬﾝ関連で、取り掛かりの敷居をさげて「とりあえず作ってみる」のには、UIFlowを使うのもいいよな、と思った。調べてみると、[namakoさん](https://twitter.com/KantenNamako)がしばらく前に作られていたようなんだけど、機能をもりすぎてごちゃごちゃになって公開できるような状態ではない、とのこと。stack-chan-testerぐらいの機能でも十分ｽﾀｯｸﾁｬﾝは体験できるから、そのあたりを目指してみようと思う。調べてみると、キモの一つである顔の表示は、[MicroPython版のM5Stack Avatarを作っている方](https://blog.akanumahiroaki.com/entry/2018/11/24/223000)をみつけた。この[M5StackAvatarPython](https://github.com/h-akanuma/M5StackAvatarPython)を[UIFlow Block Maker](https://qiita.com/ciniml/items/618899c9065d51d5c54e)を使ってUIFlowのCustomBlockにすれば、顔の表示はだいぶ抽象化できそう。この方針で進めてみよう。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-30_16.02.47.png" width="240px">

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-30_16.02.39.png" width="240px">

UIFlowとMicroPythonの関係は、こんな感じでUIFlowでブロックを置いたあとで、MicryPython表示に切り替えると、つかみやすい。この例は、タイマ割り込み関数呼び出しの例。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-30_3.53.19.png" width="240px">

本来は6月から7月に、深センではいろんな分野の展示会がほぼ毎日開催されていて、いろんな技術やビジネスを見に行こうと思っていたんだけど、ちょっと新型コロナ感染者が増えたりして（といっても深セン市全体で1日あたり10人とか）、軒並み延期になっていた。その多くが8月に開催される予定になっていて、いまのところ予定通り開催されそうな雰囲気かな、と思っている。特に、半導体、ディスプレイ、IoT、ロボットは楽しみ。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-07-30_09.36.46.jpg" width="240px">

「○○Pi」というiRaspberryPi的なボードがいくつかあるけど、その中のOrangePiのWikipedia（日本語）の記述の言葉遣いが、なんか昭和30年代の新聞記事っぽくて、なんか好き。

購読している半導体関連情報のWeChatアカウント「半导体芯科技SiSC」、いろんな会議の案内やニュースが出てくる。まあメルマガみたいなもん。今日見かけたのは、以下のもの。中国国内でもいろいろな技術開発が進んでいるのがわかる。

- [Chiplet Chinaが苏州（蘇州：上海の隣）で開催](https://mp.weixin.qq.com/s/v6HfQoXaF2YvXSXjzJg89g)
- [SmartVisionがBSI(裏面照射イメージセンサ)のプロセスの開発に成功](https://mp.weixin.qq.com/s/ENfBT2MlkUfrTOXYbG7rvA)
- [X-Fab（ドイツなどに工場をもつファウンドリ）がBCDon-SOIプロセスを開始](https://mp.weixin.qq.com/s/RXk7A_5T67MJAL_28cs13Q)
- [Micronが232層NANDフラッシュを出荷](https://mp.weixin.qq.com/s/eyuSmljVtDodTJFVQxgl5g)

***

[前の週へ](2207-3.md) /
[次の週へ](2207-5.md)

今週の
[日常](../diary/2207-4.md) /
[研究](../research/2207-4.md) /
[コロナ関連](../covid19/2207-4.md) / 
[中国語勉強](../chinese/2207-4.md) / 

[SZdiaryトップ](../../README.md)
