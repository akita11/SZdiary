## 22/06/19, Sun

STC8GマイコンをArduinoIDEで使う[stc51duino](https://github.com/nulllaborg/nulllab_stc51duino)、インストールでエラーがでる。GitHubのIssueをみると、URL間違いの指摘があがってるのに半年くらい放置されてるっぽい。で、しびれをきらしてforkしてる人がいて、[そっち](https://github.com/Timo-AL/nulllab_stc51duino)だと無事インストールはできた。README.mdに書いてある定義ファイルのURLが古いままなので、プルリクを送ってみた。

対応PCUはとりあえずSTC8G1K17だけのようだけど、まあこれはすぐに増やせそう。それよりビルドでエラーがでるな。明日以降、ビルドのログを詳しくみてみよう。

Core2にPortB/C/D/E生やすボードが閉まらない問題、PROTO moduleをはさんだら、ぴったりで、BOTTOM2もちゃんとはまる。ネジは、六角皿ネジM3x25をTaoBaoで100個も買ってしまった。

午前は、朝のちょっと優雅な（？）「早茶」を、高須さんと。研究のこととか金沢大からの留学プログラムの話とか、ゆっくりできた。

今日は午後、NT金沢でIoT LTのイベントがあったので、そちらにオンラインで参加。[「深センで2ヶ月過ごしていろいろ試してみた」](https://www.slideshare.net/junichiakita9/2-252014843)というお話を。

実はそのあとに、安先生とこのまえ知り合ったK210開発者の黄さんが会うのに（高須さんといっしょに）ご一緒する予定だったんけど、安先生が午後に急用ができたため昼ごはんをたべながら、ということになって、IoT LTが終わってすぐに合流。中国語ばかりだから全部は聞き取れないけど、ところどころにある英語のキーワードをたよりに、なんとなくは追った。さいごのほうはHuaweiとかAlibabaとかの大きな会社も、最近はAIアクセラレータのチップをつくってるよね、という話。そういえば研究室の学生（中国人）がエッジAIをやるのに、プラットフォームはなんでもいいよ、といったら、AlibabaのT-engineを選んできて、それ用のチップが載ったボードを使っている、という話をしていた。


## 22/06/20, Mon

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-06-20_12.50.07.jpg" width="240px">

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-06-20_13.00.42.jpg" width="240px">

このまえ買った親指サイズ基板ヒーターでリフロー。久しぶりに爪楊枝でクリーム半田を塗ってターゲット温度310℃で。タイマ設定の5分で220℃ぐらいまでしかあがらなかったけど、ちょうどハンダが溶けたあたり。まあいい感じで溶けてる。もうちょっとタイマ長くするか。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-06-20_12.42.41.jpg" width="240px">

このまえのGiftFairで見つけてTaoBaoで買った、Mac ColorClassic型のUSB-PD ACアダプタが届いた。顔の部分はシール。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-06-20_12.41.44.jpg" width="240px">

入力100-240Vとか、12Vが出力できるとか。ACアダプタとしてもよくできている。最後に「PPS」というのがあって、なんだろうと思ったら、[独自プロトコルで好きな電圧を引き出せる規格](https://www.jh1ifz.com/ham/usb12v/usb12v09.html)とのこと。対応ケーブルが必要なようで、また設定用のUSBドングルとあわせて[TaoBaoで買ってみた](https://www.taobao.com/list/item/571760548128.htm)。

ものすごくいまさらながら、DigiKeyで部品探してるとときどき出てくるメーカ「Rochester Semiconductor」ってなんだろうと思ったら、[EOF品のメーカ](https://eetimes.itmedia.co.jp/ee/articles/1806/27/news036.html)なのか。お恥ずかしながら初めてしりました。


## 22/06/20, Mon

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-06-21_13.54.07.png" width="240px">

TaoBaoでSTM32F030のボードないかな、と探してたたら、こんな互換チップをみつけた。LCSCにもあるようだ。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-06-21_14.04.00.png" width="240px">

STM32置き換えなんだけど、もう1つあがってるHC32FやGeehy、GigaDeviceなんかはKeilコンパイラが公式対応してるんだな。

KeilでSTM32F030のプログラムを書くの、別のプロジェクトのソースをベースにしようと思ったんだけど、使うタイマとかが違うと初期化コードが書き直しなので、結局CubeMXでベースのソース作るのが早いことに気づいた。CubeMXはSTM32の周辺I/Oの初期化関数を自動生成するツールで、[Keilの新規プロジェクト作成時にそれを使う](https://www.keil.com/pack/doc/STM32Cube/html/cubemx_using.html)ようにすれば、そのままKeilのプロジェクトの雛形がつくられるので、それをベースにプログラムを書いていけばいい。書き込み機は[プロジェクトの設定のDebugツールからST-Linkなどを指定](https://yuki-sato.com/arm/stmdiscover/stm_3_configproject.html)できる。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-06-21_19.37.02.png" width="240px">

プログラムの書き方の例は例えば[こんなの](https://www.waveshare.com/wiki/STM32CubeMX_Tutorial_Series:_PWM)とか[こんなの](https://deepbluembedded.com/stm32-pwm-example-timer-pwm-mode-tutorial/)で、関数名（の命名規則）さえ慣れれば、だいぶ楽そう。

STC51duinoのSTC8関連のファイルの整備は、先が長そうなので、ぼちぼち。いろんなファイルを順番に中身みながら、という作業が多い。昔からこういう用途にはファイラー＋汎用ビューアの組み合わせが一番便利で、Winではいまだに「卓駆」を使ってる（上流は"FD"）んだけどMacだといいのがないんよね。Wineで卓駆かなあ。



***

[前の週へ](2206-2.md) /
[次の週へ](2206-4.md)

今週の
[日常](../diary/2206-3.md) /
[研究](../research/2206-3.md) /
[コロナ関連](../covid19/2206-3.md) / 
[中国語勉強](../chinese/2206-4.md) / 

[SZdiaryトップ](../../README.md)
