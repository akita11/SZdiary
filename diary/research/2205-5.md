## 22/05/29, Sun

先週金曜の歓迎会で、詹先生と久しぶりにお会いしたことで、思い出したんだけど、アナログ、特に電源ICのファブレス業界とそこへの学生の就職志向について、ぜひ話を聞いてみようと思って、来週水曜あたりに話をできることになった。


## 22/05/30, Mon

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-05-30_17.39.06.png" width="240px">

M5Stackのやつ、Core2にGroveポートB/C/D/Eを生やすModuleを最初に進めている。ここ数日、急に暑くなったり雑用がたまっててややげんなりしてたんだけど、基板設計したら元気になった。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-05-30_20.49.42.png" width="240px">

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-05-30_20.49.54.png" width="240px">

基板設計がだいたい終わったので、シルクどうしよ？と話を振ったら、製品名きめよか→これだと長いな→じゃあこれで→シルクのデザインどうしたらいい？→これ使って(CorelDrawのファイル)、とここまで20分できまった。

今回は部品も少ないので基板だけJLCPCBに製造に出して、DIPスイッチは今日買うといってて、その他の部品はストックがあるから、あとは試作するだけ、というところまできた。

夕方は、高須さんに誘われて、最近東大発ベンチャーが続出している母体の一つの本郷テックガレージ・FoundXまわりで、Twitterスペースにおじゃましてた。金沢大のMOTでも話をしてもらっている[HarvestX](https://harvestx.jp/)の市川さんも交えて、深センにいると工場が近いからモータなどのカスタマイズがその場でできるという地の利、みたいな話をしていた。個人的な関心事としては、ああいう場がなかったころは、そういうのが好きな人（＝当時の自分）はすごい疎外感を覚えていたんだけど、いまはどうなんだろう、という点。市川さんたちの話では、8割くらいはそういう人（つまり居場所ができている）、2割くらいはそれほど技術が好きなわけじゃないけど、周りの影響で目覚めちゃう人。場って大事だな。


## 22/05/31, Tue

詹先生から[こんな動画](https://www.bilibili.com/video/BV1LY411s7pk?p=1&share_medium=android&share_plat=android&share_session_id=6112fccb-5ac7-4833-afb6-98057a3ef04b&share_source=WEIXIN&share_tag=s_i&timestamp=1653946793&unique_k=uUuLp8K)を紹介してもらった。半導体業界いいところ、みんなおいで、的なプロモーション動画。年収500万元（1000万円くらい）、みたいな文句が並ぶ。

詹先生のところの学生の就職先としては、大企業（HiSliconとか）と中小（ベンチャー）企業とは半々ぐらいらしい。研究テーマが電源ICやアナログなので、中小のファブレス企業も多く、就職の選択肢になる。なお詹先生の同級生がCTOの電源ICの会社（上海上場企業）の[纳芯微电子](https://www.novosns.com/)があるんだそうだ。研究でも、詹先生は幸いそこまで先端プロセスは必要ないので、まだ製造費がかからなくていい、といっていた。

先端ではないプロセスで作る半導体は、いわゆるローエンドになるので、海外製品のリプレースだけでも、それなりの市場規模があるので、これだけたくさんのファブレス企業が成り立つ。もっとも、ユニークな機能を持ったICを作っている会社もあって、そういうところは存在感を出している。ARMとRISC-Vの関係も、まあARMの置き換えという意義はある。

ちなみに詹先生の専門は電源ICなんだけど、[ACアダプタ（充電器）の分解専門のアカウント](https://mp.weixin.qq.com/s/hA-rVaK9fcdZMVHZqGD-UA)があって、いつも見ているそうだ。なんか[分解のススメ](https://medium.com/bunkai)っぽさを感じる。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-05-31_17.26.12.png" width="240px">

これの記事の最後に、2022/7/18-20に深センで「充電展」があって、その中にUSB-PD&Type-C大会なんてのもあるらしい。

半導体Fabは実はそんなになくて、前にも出てきたHHGrace、华润（まだちゃんと調べてない）、[SMIC](https://www.smics.com/)、外資（イスラエル）だけど中国にも工場がある积塔(TowerJazz)、あたり（あとTSMC）。なおSMICは米国輸出規制で先端ノードの製造装置が買えずに先端ノードの製造ができない、というアンフェアな状況で困ったもの。とはいえ製造装置も中国は自国開発を進めていて、すぐには無理だが長期的には自給できるようになるんじゃないか、とのこと。

こういう具体的な技術の話もだけど、学生さんとたくさん交流をするといいよ、とアドバイスをもらった。学生さんは成長していずれ会社で偉くなるし、研究者として戻ってくる人もいる。まったくそのとおりだと思う。

ちなみに詹先生はこのSMEが入ってるビル(9F)と、メインキャンパス（最初に訪問したときと同じ講義棟1）に、教員室と実験室があって、ふだんはメインキャンパスの方にいることが多いらしい。

M5StackのCore2用Grove拡張ボード（ExtPort for Core2という名称になった）は一通り設計が終わって、Jimmyにもらった画像をシルクに変換して設計終えたので、JLCPCBに製造発注してもらった。早ければ金曜に届くので、その後の早い時期（たぶん来週火曜）にM5Stackのオフィスにおじゃまして、試作とチェックをさせてもらう予定。

あわせて、もう1つのDCモータ（Hブリッジ）コントローラの仕様についても議論をすすめる。基本方針として、[ATOM-Hbridge](https://www.switch-science.com/catalog/6912/)と同じくDRV8876を使った1ch分、[VH3.96コネクタUNIT](https://www.switch-science.com/catalog/4055/)のケースを使うことまでは決まってるんだけど、基本構成の案が2つある。
- 2本のIOピン（片方はPWM）で直接DRV8876を制御。構成は単純だが複数接続がやりにくい。
- マイコンを載せてI2Cコマンド制御。複数接続も容易（I2Cは並列バスなので）だがマイコン分コストup

ただやはり拡張性を考えると後者をとりたい。制御プロトコルはM5Stack標準(?)のレジスタ直接制御のがあるので、それにならうことにする。問題は使うマイコンで、CH55xが安価でいいけどI2Cスレーブのハードウエアがないというのが致命的（面白いことにJimmyが、CH55xなら慣れてるしいいんじゃ？と言ってくれたこと）。他のM5Stack製品ではSTM32F030を使ってるんだけど、これなら1個1USDくらいで、いまでも特に入手性は問題ないらしい。もうちょっと他のマイコンも選択肢として探してみることにした。
と、ここまで話を始めてから5分ぐらいで結論が出るというスピード感。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-05-31_20.22.46.png" width="240px">


## 22/06/01, Wed

安先生といろいろ研究のお話。いくつか聞いてみたい話があって、1つ目は学生のテーマをどう与えているか、という話。安先生の研究テーマは画像処理回路で、けっこう大規模なのが多く（ちなみに来週6/8が28nmで設計してるステレオ視SoCのテープアウトでいま佳境らしい）、各学生が取り組むテーマは細かい部分にならざるを得ず、「与えられたものをやる（だけ）」になって、学生のオリジナリティとモチベーションをどう両立するか、というのはとても興味があった。

- 大きく3つくらいのプロジェクトに分かれていて、それぞれに3-4人の学生
- 研究室に入ってくるときは「画像処理に興味がある」「デジタル回路設計をやりたい」くらいのアバウトさ（まあこれはどこでもそうだ）
- 最初の2-3週間で、簡単なデジタル回路をVerilogで書いて「完成させる」。これが、どのテーマをやるにしても共通の基礎トレーニング
- その後、各プロジェクトの各部分について、概要と解決すべき課題、その解決法について個別に議論をして、やるべきことを具体化していく

この過程を通して、「これをやれ」と言われたものをやる（問題を解く、実装する）だけではなく、学生が自分の視点・観点を発揮できる場ができる、と。明確な「ゴール（夢）」を皆で共有するものをもっていて、それに至る道筋は安先生自身が（アルゴリズムや回路構成の詳細までは不要でも）見えているからこそ、このディスカッションが成り立つ。つまり研究者としては常に「ゴールとそれに至る道筋」は考え続けなければ行けない、という話。

なお次の秋学期から授業で、VerilogでカウンタやPWMのような回路を設計してFPGA実装するまで（そしてアドバンストピックとして、I2C通信あたり）をやる予定らしい。逆にいうといままではそういう内容の授業がなく（カルノー図などの論理回路の授業しかない）、研究室に入ってからVerilogを勉強、となっていた、と。ちなみにSMEとしての授業カリキュラムはカツカツなはずで（物性から回路まで幅広い）、新規に科目を入れる余地があるのかな？と思ったんだけど、選択科目だから特に問題はないらしい。

ちなみに2年生とかでもやる気と興味があれば研究室のプロジェクトに参加（単位は出ない課外活動）、というのはいまでもあるらしい。

あと以前聞いていたSMEとARM Chinaとの連携の件も聞いてみた。どうもかなり形式だけもののようで、ARMの概要みたいなスライドが提供されているだけで、ARMから授業をしにきたり、ARMでシステム開発、みたいな授業が提供されているわけでもないらしい。むしろこれからはRISC-Vがアツいよね、という話になって、[poyo-v](https://github.com/ourfool/poyo-v)のことを紹介しておいた。これぐらいの規模ならVerilogで全部を終えるので、CPUの動作の理解、みたいな教材としても十分アリ。

夕方は、M5Stack新製品開発シリーズのHブリッジドライバUNIT。結局STM32F030(TSSOP20p)を載せることにして、M5Stackで標準のISPピンやその近辺の回路構成を教えてもらってそれにあわせて、LDOをこれもM5Stackで標準で使うHT7533(SOT-89パッケージ)に変更して、モータドライバを[RZ7899](https://item.szlcsc.com/93566.html)を使うことにした。このRZ7899、SOP8のシンプルなドライバICで使いやすい（IOピンの論理レベルが3.3V系でもOK）んだけど、无锡睿智微电子という初めて聞くメーカの製品。こういうのがゴロゴロ出てくるんだよな。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-06-01_19.47.33.png" width="240px">

というわけでいつものペースで20分くらいで回路図がfixできた。


## 22/06/02, Thu

先日、アナログNeuralNetworkの研究をしている周先生からもらった最も最近の論文を一通り読んだ。光で抵抗値が変わるORRAMという素子をNeuralNetworkの重み係数に使って、あたった光パターンに応じてNeuralNetworkの学習ができる、というもの。なかなか面白い。予定を調整して来週木曜に、お互いの持ちネタを持ち寄って、discussionをすることになった。楽しみ。

昨日のM5StackのHブリッジドライバは、今日の午前のうちに基板設計。モータドライバRZ7899は放熱パッドがなくて、モータをつなぐ端子に広いベタパターンをつけてそこから放熱する、という仕様なので、なるべく広いベタパターンをとれるように。またRZ7899はデータシートの標準回路だと470uFという巨大なパスコンがついているんだけど、回路構成上電源ノイズがマイコン方面に及びにくい（別電源なので）のとあのケース（高さ4mm）にはいるサイズのものがない（モータ電源なので24Vくらいまでは使えるようにしたい）ので、とりあえず2012サイズのパッドだけつけておいて、10uFくらいで試してみることになった。DIPスイッチやLDOはM5Stackではいつもはこれを使う、というのを聞いて、さらさらっとパターンをひいた。基板外形はAMeterにあわせて、ケースを流用できるようにするんだけど、採寸ミスがあって少し修正して夕方にデータを渡した。いつもながら早いな。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-06-02_20.32.33.png" width="240px">

午後、ちょっとお手伝いしているボードがうまく動作しないというので、リモートでデバッグをしていた。実はElecrowにPCBA発注してあったもので、あれこれ指示をしながら動作チェックをしてるんだけど、とてももどかしい。結局、原因がよくわからず、同じものを再度ElecrowにPCBA発注して、こっちの自分あてに送ってもらうことにした。なかなか不思議な構図。それに関して、いつものMikeにPCBA発注の連絡をしたら、なんと6月末でElecrowをやめるんだそうだ。なんか寂しいな。故郷に返って別の仕事をするらしい。どういう仕事かはわからないけど、誠実な彼なら、大丈夫だと思う。


## 22/06/03, Fri

以前、ICの設計から量産までのワンストップサービスの会社、というのを教えてもらったのを思い出して、資料を見返していた。[摩尔精英公司](https://www.mooreelite.com/)という会社で、作りたいものを伝えると、ファブレスIC設計メーカ、製造ファブ、パッケージ工場などをまとめて紹介する、というサービス。ちなみに会社名の「摩尔」は「mo2er3」と読み、"Moore"の音訳のようだ。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-06-03_18.20.52.png" width="240px">

その中に、[製造委託先（いわゆるFab）の例](https://www.mooreelite.com/language/en/tape-out-service/)、というのが載っているのを見つけた。お恥ずかしながら初めて聞く名前もいくつかある。先日[詹先生に聞いたとき](https://github.com/akita11/SZdiary/blob/main/diary/research/2205-5.md#220531-tue)は、Fabはあんまりない、と言っていたけど、こういうところがチップ製造しているんだな。（もちろん「some of」として紹介されているので、もっと他にもあるんだろうけど）

ちなみに数年前にこの会社を教えてもらったときは、担当者も紹介してもらっていて、簡単にやりとりをしたことがあって、そのときのチャット履歴を見返したら、0.35umで研究用チップを作りたい、という具体例で聞いてみたら、最小ロットがウエハ200枚、といわれていた。まあ量産だな。

<img src="https://github.com/akita11/SZdiary/blob/main/diary/photo/2022-06-03_18.17.56.png" width="240px">

食わず嫌いはよくない、と、少しずつやっていた[Google/SkywaterのMPW6](https://docs.google.com/document/d/1KzOtfLRyEg5rr2VE-ly4egd5WnZagCqypBFIBFwALXQ/)、勝手に締め切りを6月末だと思いこんでいたんだけど、来週水曜(6/6)だった。うーむ。さすがに今から間に合わせるのは無理か・・・でも今後のためにも、一通り完成はさせておきたいところ。お題は以前作った「RISC-VでLチカ」の回路にしようと思っている。


## 22/06/04, Sat

今日の午前は、なんとなく大学に行って、書くことになっている本を少し書いていた。ちょっとペースあげていきたいところ。

半導体不足でマイコンが手に入らない、というのは日に日に増えてきていて、いよいよCH552も品薄なようだ。とはいえ困って嘆いてばかりはいられないので、とりあえず「IO数が10以下」を目安の条件として、LCSCでマイコンを探してみる。コンパイラと書き込み機の入手性がよければ、それなりに使えそうなので、この2点の状況も軽く整理。PICやAVRというのは除外して、CPUコアがARMも除外すると、ざっと以下のものがでてきた。いずれも中国のメーカ。

- STC Micro, STC8G：8051コア, ライタはU8W/U8W-Mini(1000円くらい、[Taobaoにあり](https://item.taobao.com/item.htm?spm=a230r.1.14.6.26a42cd1A2sf8a&id=600565855805&ns=1&abbucket=3#detail)), SDCCでコンパイル可、[簡易ライブラリあり](https://github.com/IOsetting/FwLib_STC8)
- Fuman, XMC8P53S6, 独自コア、コンパイラ・書き込み機が不明
- Sonix, SN8P, コンパイラ=Sonix IDE M2IDE, 書き込み機 MPIII Writer (Taobaoでは売ってない)
- Fermont Micro, FT60F210, コンパイラは代理店に問い合わせ, ライタはWebに記載はあるが入手性不明
- SinOne, SC92F7490, 8051コア（たぶんSDCCでコンパイルできる）, 書き込み気（量産用）SC LINK (Taobaoでは売ってない), 純正IDEあり
- Holtek, HT46R, コンパイラ・書き込み機は純正のもの（入手性不明）
- PADAUK, PMS150C, 書き込み機：PDK3S-P-002（入手性不明）
- ABOV Semicon, MC94F, 書き込み機: E-PGM+(Taobaoあり、2万円近い） / PGMPlusLC2

※以下現在LCSCに在庫がないので詳しく調べていない

- Melexis, MLX811
- YspringTech, MDT10F
- Qingdao Eastsoft, HR7P153
- Cmsemicon, CMS79F111
- Holychip, HC18P110

やはり業務用というか、コンパイラや書き込み機・デバッガがWebから落とせたりTaoBaoで売ってるのは、かなり少なく、STC MicroのSTC8Gの一択のようだ。

とりあえず書き込み機のU8W-MiniをTaobaoでポチったので、明日にでも評価ボードを設計してみよう。と思ったら、評価ボードはTaobaoにもいくつかあって、どう見てもUSB-UART変換機が「ダウンロードケーブル」として売っていたりする。とりあえず一通り買って、明日くわしく調べてみよう。（[参考](https://twitter.com/akita11/status/1533040984317399041)）


***

[前の週へ](2205-4.md) /
[次の週へ](2206-1.md)

今週の
[日常](../diary/2205-5.md) /
[研究](../research/2205-5.md) /
[コロナ関連](../covid19/2205-5.md) / 
[中国語勉強](../chinese/2205-5.md)

[SZdiaryトップ](../../README.md)
